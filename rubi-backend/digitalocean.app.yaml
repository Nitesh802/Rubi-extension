spec:
  name: rubi-backend
  region: nyc
  services:
    - name: api
      dockerfile_path: Dockerfile
      source_dir: /
      github:
        branch: main
        deploy_on_push: true
        repo: your-github-username/rubi-backend
      build_command: npm install && npm run build
      run_command: npm start
      environment_slug: node-js
      instance_count: 1
      instance_size_slug: professional-xs
      http_port: 3000
      health_check:
        http_path: /health
        initial_delay_seconds: 10
        period_seconds: 30
        timeout_seconds: 5
        success_threshold: 1
        failure_threshold: 3
      routes:
        - path: /
      envs:
        - key: NODE_ENV
          value: production
          scope: RUN_TIME
          type: GENERAL
        - key: PORT
          value: "3000"
          scope: RUN_TIME
          type: GENERAL
        - key: LOG_LEVEL
          value: info
          scope: RUN_TIME
          type: GENERAL
        - key: APP_BASE_URL
          value: https://rubi-backend-xxxxx.ondigitalocean.app
          scope: RUN_TIME
          type: GENERAL
        - key: JWT_SECRET
          scope: RUN_TIME
          type: SECRET
        - key: ADMIN_JWT_SECRET
          scope: RUN_TIME
          type: SECRET
        - key: OPENAI_API_KEY
          scope: RUN_TIME
          type: SECRET
        - key: ANTHROPIC_API_KEY
          scope: RUN_TIME
          type: SECRET
        - key: GOOGLE_API_KEY
          scope: RUN_TIME
          type: SECRET
        - key: MOODLE_BASE_URL
          scope: RUN_TIME
          type: GENERAL
        - key: MOODLE_CONFIG_API_TOKEN
          scope: RUN_TIME
          type: SECRET
        - key: MOODLE_CONFIG_ENABLED
          value: "true"
          scope: RUN_TIME
          type: GENERAL
        - key: MOODLE_IDENTITY_JWT_SECRET
          scope: RUN_TIME
          type: SECRET
        - key: MOODLE_CONFIG_TIMEOUT
          value: "30000"
          scope: RUN_TIME
          type: GENERAL
        - key: ORG_INTELLIGENCE_PATH
          value: ./org-config/intelligence
          scope: RUN_TIME
          type: GENERAL
        - key: PROVIDER_PRIMARY
          value: openai
          scope: RUN_TIME
          type: GENERAL
        - key: PROVIDER_FALLBACKS
          value: anthropic,google
          scope: RUN_TIME
          type: GENERAL
        - key: RATE_LIMIT_MAX
          value: "100"
          scope: RUN_TIME
          type: GENERAL
        - key: RATE_LIMIT_WINDOW
          value: "60000"
          scope: RUN_TIME
          type: GENERAL
        - key: CORS_ALLOWED_ORIGINS
          value: https://linkedin.com,https://www.linkedin.com,https://salesforce.com,https://login.salesforce.com
          scope: RUN_TIME
          type: GENERAL
      cors:
        allow_origins:
          - prefix: https://linkedin.com
          - prefix: https://www.linkedin.com
          - prefix: https://salesforce.com
          - prefix: https://login.salesforce.com
        allow_methods:
          - GET
          - POST
          - PUT
          - DELETE
          - OPTIONS
        allow_headers:
          - Content-Type
          - Authorization
          - X-Requested-With
        expose_headers:
          - Content-Length
          - X-Request-Id
        max_age: 3600
        allow_credentials: true
  features:
    - buildpack-stack=ubuntu-22